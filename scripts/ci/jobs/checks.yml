compiler warnings:
  stage: checks
  variables:
    GIT_STRATEGY: none
  allow_failure: true
  dependencies:
    - build
    - build win
  script:
    - exit_code=0
    - cd build
    - "if [[ $(cat make.output | grep warning -i) ]]; then echo 'There were compiler warnings:'; cat make.output | grep warning -i; exit_code=1; fi"
    - cd ../build-win
    - "if [[ $(cat make.output | grep ': warning' -i) ]]; then echo 'There were compiler warnings:'; cat make.output | grep ': warning' -i; exit_code=1; fi"
    - exit $exit_code


ctest results:
  stage: checks
  variables:
    GIT_STRATEGY: none
  tags:
    - singularity
  dependencies:
    - build
    - "build win"
  script:
    - singularity run docker://$XUNIT_TO_JUNIT_IMAGE -s:./build/Tests/ctest.xml > build/ctest-junit.xml
    - singularity run docker://$XUNIT_TO_JUNIT_IMAGE -s:./build-win/Tests/ctest.xml > build-win/ctest-junit.xml
  artifacts:
    paths:
      - build/ctest-junit.xml
      - build-win/ctest-junit.xml
    expire_in: 1 week
    reports:
      junit:
        - build/ctest-junit.xml
        - build-win/ctest-junit.xml
