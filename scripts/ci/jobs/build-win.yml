build win:
  stage: test
  tags:
    - windows
  variables:
    BUILD_DIR: "build-win"
  extends: .vs2019-environment

  script:
    - mkdir -p $BUILD_DIR
    - cd $BUILD_DIR
    - |
      cmake .. -G Ninja `
        -DCMAKE_BUILD_TYPE=Release `
        -DOGS_BUILD_PROCESSES=GroundwaterFlow `
        -DOGS_USE_PYTHON=ON `
        -DOGS_BUILD_GUI=ON `
        -DOGS_BUILD_UTILS=ON `
        -DOGS_BUILD_SWMM=ON `
        -DOGS_USE_NETCDF=ON
    - cmake --build . --target tests
    - cmake --build . --target ctest
    - cp Testing/**/Test.xml Tests/ctest.xml
    - cmake --build .

  artifacts:
    paths:
      - $BUILD_DIR/Tests/ctest.xml
      - $BUILD_DIR/Tests/testrunner.xml
    expire_in: 1 week
    reports:
      junit:
        - $BUILD_DIR/Tests/testrunner.xml
