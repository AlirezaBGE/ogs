build linux:
  image: $CONTAINER_GCC_IMAGE
  extends:
    - .template-build-linux
    - .test-artifacts
  tags: [docker]
  needs: [meta, ci_images]
  timeout: 2h
  variables:
    BUILD_CTEST_LARGE_ON_MASTER: "true"
    CMAKE_PRESET: release-all
    CMAKE_ARGS: >-
      -DOGS_$USE_PYTHON
      -DOGS_INSTALL_DEPENDENCIES=ON
  parallel:
    matrix:
      - USE_PYTHON: ["USE_PYTHON=ON", "USE_PYTHON=OFF"]

linux ctest large:
  image: $CONTAINER_GCC_IMAGE
  extends:
    - .template-build-linux
  tags: [docker, envinf2]
  needs: [meta, ci_images]
  rules:
    - when: manual
      allow_failure: true
  timeout: 2h
  variables:
    TARGETS: ctest-large
    CMAKE_PRESET: release-all
    CMAKE_ARGS: >-
      -DOGS_USE_PYTHON=ON

build linux (no unity):
  image: $CONTAINER_GCC_IMAGE
  extends:
    - .template-build-linux
    - .test-artifacts
  tags: [docker]
  needs: [meta, ci_images]
  timeout: 1h
  variables:
    BUILD_TESTS: "false"
    BUILD_CTEST: "false"
    CHECK_WARNINGS: "true"
    CMAKE_PRESET: ci-no-unity

build linux (no deps, no procs):
  image: $CONTAINER_GCC_IMAGE
  extends: .template-build-linux
  tags: [docker]
  needs: [meta, ci_images]
  timeout: 1h
  variables:
    BUILD_TESTS: "false"
    BUILD_CTEST: "false"
    BUILD_PROCESSES: "SteadyStateDiffusion"
    CMAKE_PRESET: ci-simplest

build linux arch:
  extends:
    - .template-build-linux
    - .test-artifacts
  tags: [shell, envinf]
  needs: [meta]
  variables:
    CMAKE_PRESET: release-all
    CMAKE_ARGS: >-
      -DBUILD_SHARED_LIBS=ON
      -DOGS_USE_POETRY=OFF

build linux ubuntu:
  extends:
    - .template-build-linux
    - .test-artifacts
    - .rules-master-manual
  tags: [shell, ubuntu]
  needs: [meta]
  variables:
    CMAKE_PRESET: release-all
